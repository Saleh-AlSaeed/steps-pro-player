<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Steps Production Co Player</title>

  <!-- Ø«Ø¨Ù‘Øª Ù†Ø³Ø®Ø© Hls.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15/dist/hls.min.js"></script>

  <link rel="icon"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%230b0b0f'/%3E%3Cpolygon points='26,20 26,44 46,32' fill='%23e53935'/%3E%3C/svg%3E" />

  <style>
    :root{--btn-bg:#e53935;--btn-bg-h:#d32f2f;--btn-bg-a:#b71c1c;--btn-txt:#fff;--panel-bg:#0b0b0fcc;--panel-bd:#ffffff26}
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:#000;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #playerContainer{position:relative;width:100vw;height:100vh}
    .videoFrame{position:absolute;top:0;right:0;width:100%;height:100%;background:#000;overflow:hidden}
    #mainPreview{position:absolute;top:16px;right:20px;width:22%;height:24%;z-index:6;border:1px solid #fff2;border-radius:18px;cursor:pointer;transition:transform .18s,box-shadow .18s,width .18s,height .18s,top .18s,right .18s,left .18s}
    #mainPreview:hover{box-shadow:0 10px 30px #0008}
    #mainPreview video{display:block;width:100%;height:100%;object-fit:contain}
    .split #mainPreview{top:0;right:0;width:50%;height:100%;border:0;border-radius:0;cursor:default}
    .split #activeCam{top:0;left:0;right:auto;width:50%;height:100%}
    .split.fill #mainPreview video,.split.fill #activeCam video{object-fit:cover}
    .main-full #mainPreview{top:0;right:0;width:100%;height:100%;z-index:7;border:0;border-radius:0;cursor:zoom-out}
    .main-full #activeCam{display:none}
    .hint{position:absolute;top:20px;right:20px;z-index:8;background:#000a;color:#fff;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid #fff2}
    .split .hint,.main-full .hint{display:none}

    #utilityControls,#camControls,#globalControls{position:absolute;z-index:10;display:flex;gap:8px;flex-wrap:wrap}
    #utilityControls{top:10px;right:10px}
    #globalControls{bottom:70px;left:50%;transform:translateX(-50%);background:var(--panel-bg);padding:10px;border-radius:14px;border:1px solid var(--panel-bd);align-items:center;min-width:340px}
    #globalControls.hidden{display:none}

    button{-webkit-tap-highlight-color:transparent;appearance:none;border:0;outline:0;cursor:pointer;background:var(--btn-bg);color:var(--btn-txt);padding:11px 12px;font-size:12px;font-weight:800;border-radius:12px;letter-spacing:.2px;display:inline-flex;align-items:center;gap:8px;box-shadow:0 8px 18px #000a,0 0 0 0 rgba(211,47,47,.28);transition:transform .12s,box-shadow .12s,background .12s}
    button:hover{background:var(--btn-bg-h);box-shadow:0 12px 26px #000c,0 0 0 6px rgba(211,47,47,.28)} button:active{background:var(--btn-bg-a);transform:translateY(1px)}

    #scrub{-webkit-appearance:none;appearance:none;width:320px;height:6px;border-radius:999px;background:#ffffff30;outline:none;margin:0 8px}
    #scrub::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#fff;border:2px solid #0006;cursor:pointer}
    #timeLabel{color:#fff;font-size:12px;min-width:108px;text-align:center}

    #gatePlay{position:absolute;inset:0;z-index:9;display:flex;align-items:center;justify-content:center;background:linear-gradient(140deg,rgba(0,0,0,.55),rgba(0,0,0,.2))}
    #gatePlay.hidden{display:none}
    .gate-card{background:var(--panel-bg);border:1px solid var(--panel-bd);border-radius:18px;padding:18px 20px;display:flex;gap:12px;align-items:center;box-shadow:0 10px 40px rgba(0,0,0,.45)}
    .gate-card .icon{width:32px;height:32px;border-radius:50%;display:grid;place-items:center;border:1px solid var(--panel-bd);color:#fff;background:#111a;font-size:18px}
    #startBtn{min-width:160px}

    #camControls{bottom:14px;left:50%;transform:translateX(-50%);background:var(--panel-bg);padding:10px;border-radius:14px;border:1px solid var(--panel-bd)}

    @media (orientation: portrait){
      #mainPreview{top:12px;right:14px;width:58vw;height:36vh;border-radius:18px}
      #globalControls{position:fixed;bottom:calc(env(safe-area-inset-bottom,0px) + 8px);left:50%;transform:translateX(-50%);width:min(94vw,560px);padding:8px 10px;z-index:9999}
      #scrub{width:clamp(140px,56vw,380px)}
      #camControls{top:60px;left:6px;right:auto;bottom:auto;flex-direction:column;gap:6px;padding:8px 6px;max-height:58vh;overflow:auto;background:linear-gradient(180deg,#0b0b0fb3,#0b0b0f99);border:1px solid var(--panel-bØ¯);border-radius:14px;width:46px;transition:width .18s,box-shadow .18s;box-shadow:0 8px 24px rgba(0,0,0,.35);z-index:12}
      #camControls:hover,#camControls.expanded{width:150px}
      #camControls button{justify-content:flex-start;padding:8px 10px;width:100%;font-size:10px;background:#1a1f2a;color:#fff;border:1px solid #ffffff1f;box-shadow:inset 0 0 0 1px #0003}
      #camControls:not(.expanded):not(:hover) button span{display:none}
    }
  </style>
</head>
<body>
  <div id="playerContainer" aria-label="Ù…Ø´ØºÙ‘Ù„ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª">
    <div id="activeCam" class="videoFrame" aria-label="Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù†Ø´Ø·Ø©"></div>
    <div id="mainPreview" class="videoFrame" title="Ø§Ù†Ù‚Ø± Ù„Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ±" aria-label="Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…ØµØºÙ‘Ø±Ø©"></div>
    <div class="hint">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„ØªÙƒØ¨ÙŠØ± â€¢ Ø£Ùˆ Ø§Ø¶ØºØ· F</div>

    <!-- Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¨Ø¯Ø¡ -->
    <div id="gatePlay" role="dialog" aria-modal="true" aria-label="Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„">
      <div class="gate-card">
        <div class="icon">â–¶</div>
        <div>
          <div style="color:#fff;font-weight:800;margin-bottom:6px">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„ ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</div>
          <div style="font-size:12px;color:#eaeaf0b3">Ø³ÙŠØ¸Ù‡Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…/Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ´ØºÙŠÙ„</div>
        </div>
        <button id="startBtn" aria-label="Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù†">ØªØ´ØºÙŠÙ„/Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</button>
      </div>
    </div>

    <!-- Ø£Ø¯ÙˆØ§Øª -->
    <div id="utilityControls" role="toolbar" aria-label="Ø£Ø¯ÙˆØ§Øª">
      <button id="btnSplit" aria-label="ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…" title="ØªÙ‚Ø³ÙŠÙ…">ØªÙ‚Ø³ÙŠÙ…</button>
      <button id="btnFill"  aria-label="ØªØ¨Ø¯ÙŠÙ„ Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰" title="Ù…Ù„Ø¡">Ù…Ù„Ø¡</button>
      <button id="btnSound" aria-label="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª" title="ØµÙˆØª">ğŸ”Š/ğŸ”‡</button>
    </div>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ÙˆØ­Ù‘Ø¯ -->
    <div id="globalControls" class="hidden" role="group" aria-label="ØªØ­ÙƒÙ… Ù…ÙˆØ­Ù‘Ø¯">
      <button id="gBack" title="âª -5s">âª 5s</button>
      <button id="gPlay" title="â¯">â¯</button>
      <button id="gFwd"  title="+5s â©">5s â©</button>
      <input id="scrub" type="range" min="0" max="0" value="0" step="0.01" aria-label="Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…">
      <div id="timeLabel">00:00 / 00:00</div>
    </div>

    <!-- Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª -->
    <div id="camControls" role="toolbar" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª">
      <button data-cam="cam1"><span>Cam1</span></button>
      <button data-cam="cam2"><span>Cam2</span></button>
      <button data-cam="cam3"><span>Cam3</span></button>
      <button data-cam="cam4"><span>Cam4</span></button>
      <button data-cam="cam5"><span>Cam5</span></button>
      <button data-cam="cam6"><span>Cineflex</span></button>
      <button data-cam="cam7"><span>Drone</span></button>
    </div>
  </div>

<script>
  // Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ /hls/
  window.sources = {
    main: "/hls/live/playlist.m3u8",
    cam1: "/hls/lastone/playlist.m3u8",
    cam2: "/hls/live2/playlist.m3u8",
    cam3: "/hls/live3/playlist.m3u8",
    cam4: "/hls/live4/playlist.m3u8",
    cam5: "/hls/live5/playlist.m3u8",
    cam6: "/hls/live6/playlist.m3u8",  // Cineflex
    cam7: "/hls/live7/playlist.m3u8"   // Drone
  };
</script>

<script>
  /* ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆÙ…Ø¹Ø§Ø¯ÙÙ„Ø§Øª ====== */
  const hasUrl = (u)=> typeof u==='string' && /^\/hls\/.+\.m3u8(\?.*)?$/i.test(u);

  // ÙŠØªÙ… Ø¶Ø¨Ø·Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ù…Ø§Ù†ÙŠÙØ³Øª
  let TD = 0.5; // targetduration (s) ÙƒÙ‚ÙŠÙ…Ø© Ø£ÙˆÙ„ÙŠØ© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
  const minNudge = 0.25, maxNudge = 0.8;
  const dynNudge = ()=> Math.max(minNudge, Math.min(maxNudge, TD*0.7));
  const dynSafety = ()=> Math.max(0.4, Math.min(1.2, TD*1.2));

  // ØªØ±Ø´ÙŠØ­ AVC ÙÙ‚Ø·
  const isAvc = (l)=> /avc1/i.test(l?.codecs || l?.codecsVideo || "");
  const isHevc= (l)=> /(hvc1|hev1)/i.test(l?.codecs || l?.codecsVideo || "");
  function pickBestAvc(levels, capH=480){
    if(!levels?.length) return -1;
    const avc = levels.map((l,i)=>({i,h:l.height||0,avc:isAvc(l)})).filter(x=>x.avc);
    if(!avc.length) return 0;
    let c = avc.filter(x=>x.h && x.h<=capH); if(!c.length) c=avc;
    c.sort((a,b)=>a.h-b.h); return c[c.length-1].i;
  }
  function highestAvcIndex(levels){ let m=-1; (levels||[]).forEach((l,i)=>{ if(isAvc(l)) m=i; }); return m>=0?m:(levels?.length?levels.length-1:-1); }

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Hls.js Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  const HLS_CFG = {
    lowLatencyMode: false,
    liveSyncDurationCount: 6,
    liveMaxLatencyDurationCount: 18,
    backBufferLength: 120,
    maxBufferLength: 35,
    maxMaxBufferLength: 180,
    maxBufferHole: 2.0,
    maxSeekHole: 2.5,
    maxFragLookUpTolerance: 0.3,
    nudgeOffset: 0.4,
    nudgeMaxRetry: 8,
    enableWorker: true,
    capLevelToPlayerSize: true,
    abrMaxWithRealBitrate: true,
    fragLoadingMaxRetry: 8,
    manifestLoadingMaxRetry: 8,
    levelLoadingMaxRetry: 6,
    fragLoadingRetryDelay: 500,
    manifestLoadingRetryDelay: 800,
    levelLoadingRetryDelay: 800,
    fragLoadingTimeOut: 12000,
    manifestLoadingTimeOut: 9000,
    levelLoadingTimeOut: 9000,
    xhrSetup: (xhr)=>{ try{ xhr.withCredentials=false; }catch(e){} }
  };

  /* ====== util Ù„Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¨Ø­Ø« ====== */
  function getSeekableRange(v
